from typing import List, Dict
import firebase_admin
from firebase_admin import db
from datetime import datetime

class SanQuestion:
    def __init__(self, positive_pole: str, negative_pole: str, score: int = 0):
        self.positive_pole = positive_pole
        self.negative_pole = negative_pole
        self.score = score

    def to_dict(self):
        return {
            'positive_pole': self.positive_pole,
            'negative_pole': self.negative_pole,
            'score': self.score
        }

class TestResult:
    def __init__(self, wellbeing: float, activity: float, mood: float, timestamp: int = None):
        self.wellbeing = wellbeing
        self.activity = activity
        self.mood = mood
        self.timestamp = timestamp or int(datetime.now().timestamp() * 1000)

    def to_dict(self):
        return {
            'wellbeing': self.wellbeing,
            'activity': self.activity,
            'mood': self.mood,
            'timestamp': self.timestamp
        }

class SANTestService:
    def __init__(self):
        self.questions = self._initialize_questions()
        self.wellbeing_indices = [0, 1, 6, 7, 12, 13, 18, 19, 24, 25]
        self.activity_indices = [2, 3, 8, 9, 14, 15, 20, 21, 26, 27]
        self.mood_indices = [4, 5, 10, 11, 16, 17, 22, 23, 28, 29]

    def _initialize_questions(self) -> List[SanQuestion]:
        question_list = [
            SanQuestion("–°–∞–º–æ—á—É–≤—Å—Ç–≤–∏–µ —Ö–æ—Ä–æ—à–µ–µ", "–°–∞–º–æ—á—É–≤—Å—Ç–≤–∏–µ –ø–ª–æ—Ö–æ–µ"),
            SanQuestion("–ß—É–≤—Å—Ç–≤—É—é —Å–µ–±—è —Å–∏–ª—å–Ω—ã–º", "–ß—É–≤—Å—Ç–≤—É—é —Å–µ–±—è —Å–ª–∞–±—ã–º"),
            SanQuestion("–ê–∫—Ç–∏–≤–Ω—ã–π", "–ü–∞—Å—Å–∏–≤–Ω—ã–π"),
            SanQuestion("–ü–æ–¥–≤–∏–∂–Ω—ã–π", "–ú–∞–ª–æ–ø–æ–¥–≤–∏–∂–Ω—ã–π"),
            SanQuestion("–í–µ—Å–µ–ª—ã–π", "–ì—Ä—É—Å—Ç–Ω—ã–π"),
            SanQuestion("–•–æ—Ä–æ—à–µ–µ –Ω–∞—Å—Ç—Ä–æ–µ–Ω–∏–µ", "–ü–ª–æ—Ö–æ–µ –Ω–∞—Å—Ç—Ä–æ–µ–Ω–∏–µ"),
            SanQuestion("–†–∞–±–æ—Ç–æ—Å–ø–æ—Å–æ–±–Ω—ã–π", "–†–∞–∑–±–∏—Ç—ã–π"),
            SanQuestion("–ü–æ–ª–Ω—ã–π —Å–∏–ª", "–û–±–µ—Å—Å–∏–ª–µ–Ω–Ω—ã–π"),
            SanQuestion("–ë—ã—Å—Ç—Ä—ã–π", "–ú–µ–¥–ª–∏—Ç–µ–ª—å–Ω—ã–π"),
            SanQuestion("–î–µ—è—Ç–µ–ª—å–Ω—ã–π", "–ë–µ–∑–¥–µ—è—Ç–µ–ª—å–Ω—ã–π"),
            SanQuestion("–°—á–∞—Å—Ç–ª–∏–≤—ã–π", "–ù–µ—Å—á–∞—Å—Ç–Ω—ã–π"),
            SanQuestion("–ñ–∏–∑–Ω–µ—Ä–∞–¥–æ—Å—Ç–Ω—ã–π", "–ú—Ä–∞—á–Ω—ã–π"),
            SanQuestion("–†–∞—Å—Å–ª–∞–±–ª–µ–Ω–Ω—ã–π", "–ù–∞–ø—Ä—è–∂–µ–Ω–Ω—ã–π"),
            SanQuestion("–ó–¥–æ—Ä–æ–≤—ã–π", "–ë–æ–ª—å–Ω–æ–π"),
            SanQuestion("–£–≤–ª–µ—á–µ–Ω–Ω—ã–π", "–ë–µ–∑—É—á–∞—Å—Ç–Ω—ã–π"),
            SanQuestion("–ó–∞–∏–Ω—Ç–µ—Ä–µ—Å–æ–≤–∞–Ω–Ω—ã–π", "–†–∞–≤–Ω–æ–¥—É—à–Ω—ã–π"),
            SanQuestion("–í–æ—Å—Ç–æ—Ä–∂–µ–Ω–Ω—ã–π", "–£–Ω—ã–ª—ã–π"),
            SanQuestion("–†–∞–¥–æ—Å—Ç–Ω—ã–π", "–ü–µ—á–∞–ª—å–Ω—ã–π"),
            SanQuestion("–û—Ç–¥–æ—Ö–Ω—É–≤—à–∏–π", "–£—Å—Ç–∞–ª—ã–π"),
            SanQuestion("–°–≤–µ–∂–∏–π", "–ò–∑–Ω—É—Ä–µ–Ω–Ω—ã–π"),
            SanQuestion("–í–æ–∑–±—É–∂–¥–µ–Ω–Ω—ã–π", "–°–æ–Ω–ª–∏–≤—ã–π"),
            SanQuestion("–ñ–µ–ª–∞–Ω–∏–µ —Ä–∞–±–æ—Ç–∞—Ç—å", "–ñ–µ–ª–∞–Ω–∏–µ –æ—Ç–¥–æ—Ö–Ω—É—Ç—å"),
            SanQuestion("–°–ø–æ–∫–æ–π–Ω—ã–π", "–í–∑–≤–æ–ª–Ω–æ–≤–∞–Ω–Ω—ã–π"),
            SanQuestion("–û–ø—Ç–∏–º–∏—Å—Ç–∏—á–Ω—ã–π", "–ü–µ—Å—Å–∏–º–∏—Å—Ç–∏—á–Ω—ã–π"),
            SanQuestion("–í—ã–Ω–æ—Å–ª–∏–≤—ã–π", "–£—Ç–æ–º–ª—è–µ–º—ã–π"),
            SanQuestion("–ë–æ–¥—Ä—ã–π", "–í—è–ª—ã–π"),
            SanQuestion("–°–æ–æ–±—Ä–∞–∂–∞—Ç—å –ª–µ–≥–∫–æ", "–°–æ–æ–±—Ä–∞–∂–∞—Ç—å —Ç—Ä—É–¥–Ω–æ"),
            SanQuestion("–í–Ω–∏–º–∞—Ç–µ–ª—å–Ω—ã–π", "–†–∞—Å—Å–µ—è–Ω–Ω—ã–π"),
            SanQuestion("–ü–æ–ª–Ω—ã–π –Ω–∞–¥–µ–∂–¥", "–†–∞–∑–æ—á–∞—Ä–æ–≤–∞–Ω–Ω—ã–π"),
            SanQuestion("–î–æ–≤–æ–ª—å–Ω—ã–π", "–ù–µ–¥–æ–≤–æ–ª—å–Ω—ã–π")
        ]
        return question_list

    def get_questions(self) -> List[Dict]:
        """–í–æ–∑–≤—Ä–∞—â–∞–µ—Ç —Å–ø–∏—Å–æ–∫ –≤–æ–ø—Ä–æ—Å–æ–≤ –¥–ª—è —Ñ—Ä–æ–Ω—Ç–µ–Ω–¥–∞."""
        return [q.to_dict() for q in self.questions]

    def process_answers(self, answers: List[int]) -> Dict[str, any]:
        """–û–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç –æ—Ç–≤–µ—Ç—ã (—Å–ø–∏—Å–æ–∫ –∏–∑ 30 scores –æ—Ç 1 –¥–æ 7), —Ä–∞—Å—Å—á–∏—Ç—ã–≤–∞–µ—Ç –±–∞–ª–ª—ã –∏ –∏–Ω—Ç–µ—Ä–ø—Ä–µ—Ç–∞—Ü–∏—é."""
        if len(answers) != 30:
            raise ValueError("–î–æ–ª–∂–Ω–æ –±—ã—Ç—å —Ä–æ–≤–Ω–æ 30 –æ—Ç–≤–µ—Ç–æ–≤.")
        for a in answers:
            if not 1 <= a <= 7:
                raise ValueError("–û—Ç–≤–µ—Ç—ã –¥–æ–ª–∂–Ω—ã –±—ã—Ç—å –æ—Ç 1 –¥–æ 7.")

        # –†–∞—Å—Å—á–∏—Ç—ã–≤–∞–µ–º –±–∞–ª–ª—ã –ø–æ –∫–∞—Ç–µ–≥–æ—Ä–∏—è–º (direct scoring: average 1-7, –±–µ–∑ –∏–Ω–≤–µ—Ä—Å–∏–∏)
        wellbeing_score = self._calculate_category_score(answers, self.wellbeing_indices)
        activity_score = self._calculate_category_score(answers, self.activity_indices)
        mood_score = self._calculate_category_score(answers, self.mood_indices)

        # –ò–Ω—Ç–µ—Ä–ø—Ä–µ—Ç–∞—Ü–∏—è
        interpretation = self._interpret_state(wellbeing_score, activity_score, mood_score)

        timestamp = int(datetime.now().timestamp() * 1000)

        return {
            'wellbeing': round(wellbeing_score, 1),
            'activity': round(activity_score, 1),
            'mood': round(mood_score, 1),
            'timestamp': timestamp,
            'interpretation': interpretation
        }

    def _calculate_category_score(self, answers: List[int], indices: List[int]) -> float:
        """–†–∞—Å—Å—á–∏—Ç—ã–≤–∞–µ—Ç —Å—Ä–µ–¥–Ω–∏–π —Å–∫–æ—Ä –¥–ª—è –∫–∞—Ç–µ–≥–æ—Ä–∏–∏ (average 1-7, direct scoring)."""
        category_scores = [answers[i] for i in indices]
        return sum(category_scores) / len(indices)

    def _interpret_state(self, wellbeing: float, activity: float, mood: float) -> str:
        """–ò–Ω—Ç–µ—Ä–ø—Ä–µ—Ç–∏—Ä—É–µ—Ç —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã –∏ –≥–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ –∫–∞–∫ –ø–æ–ª–Ω—É—é —Å—Ç—Ä–æ–∫—É."""
        state = []
        overall_score = (wellbeing + activity + mood) / 3.0

        # –û–ø—Ä–µ–¥–µ–ª—è–µ–º –æ—Å–Ω–æ–≤–Ω–æ–π —Å—Ç–∞—Ç—É—Å
        state.append("")
        if overall_score >= 5.5:
            state.append("–û—Ç–ª–∏—á–Ω–æ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ! ‚≠ê")
            state.append("–í—ã —á—É–≤—Å—Ç–≤—É–µ—Ç–µ —Å–µ–±—è –±–æ–¥—Ä–æ, –∞–∫—Ç–∏–≤–Ω–æ –∏ –≤ —Ö–æ—Ä–æ—à–µ–º –Ω–∞—Å—Ç—Ä–æ–µ–Ω–∏–∏.")
            state.append("")
            state.append("–î–µ—Ç–∞–ª–∏:")
            state.append("- –í–∞—à–∏ –ø–æ–∫–∞–∑–∞—Ç–µ–ª–∏ —Å–±–∞–ª–∞–Ω—Å–∏—Ä–æ–≤–∞–Ω—ã, —á—Ç–æ –≥–æ–≤–æ—Ä–∏—Ç –æ –≥–∞—Ä–º–æ–Ω–∏—á–Ω–æ–º —Å–æ—Å—Ç–æ—è–Ω–∏–∏.")
        elif overall_score >= 4.5:
            state.append("–•–æ—Ä–æ—à–µ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ! üåü")
            state.append("–í—ã —á—É–≤—Å—Ç–≤—É–µ—Ç–µ —Å–µ–±—è –¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ —Ö–æ—Ä–æ—à–æ –∏ —ç–Ω–µ—Ä–≥–∏—á–Ω–æ.")
            state.append("")
            state.append("–î–µ—Ç–∞–ª–∏:")
            state.append("- –ü–æ–∫–∞–∑–∞—Ç–µ–ª–∏ –Ω–∞—Ö–æ–¥—è—Ç—Å—è –Ω–∞ —Å—Ç–∞–±–∏–ª—å–Ω–æ–º —É—Ä–æ–≤–Ω–µ, –µ—Å—Ç—å –Ω–µ–±–æ–ª—å—à–æ–π –ø–æ—Ç–µ–Ω—Ü–∏–∞–ª –¥–ª—è —É–ª—É—á—à–µ–Ω–∏—è.")
        elif overall_score >= 3.5:
            state.append("–ù–æ—Ä–º–∞–ª—å–Ω–æ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ üå§")
            state.append("–í—ã —á—É–≤—Å—Ç–≤—É–µ—Ç–µ —Å–µ–±—è —É–º–µ—Ä–µ–Ω–Ω–æ, —Å –Ω–µ–∫–æ—Ç–æ—Ä—ã–º–∏ –∫–æ–ª–µ–±–∞–Ω–∏—è–º–∏ –≤ —Å–∞–º–æ—á—É–≤—Å—Ç–≤–∏–∏.")
            state.append("")
            state.append("–î–µ—Ç–∞–ª–∏:")
            state.append("- –ü–æ–∫–∞–∑–∞—Ç–µ–ª–∏ –≤ –ø—Ä–µ–¥–µ–ª–∞—Ö –Ω–æ—Ä–º—ã, –Ω–æ –µ—Å—Ç—å –æ–±–ª–∞—Å—Ç–∏, —Ç—Ä–µ–±—É—é—â–∏–µ –≤–Ω–∏–º–∞–Ω–∏—è.")
        elif overall_score >= 2.5:
            state.append("–ü–æ–Ω–∏–∂–µ–Ω–Ω–æ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ üå•")
            state.append("–í—ã —á—É–≤—Å—Ç–≤—É–µ—Ç–µ –Ω–µ–∫–æ—Ç–æ—Ä—É—é —É—Å—Ç–∞–ª–æ—Å—Ç—å –∏ —Å–ø–∞–¥ —ç–Ω–µ—Ä–≥–∏–∏.")
            state.append("")
            state.append("–î–µ—Ç–∞–ª–∏:")
            state.append("- –ü–æ–∫–∞–∑–∞—Ç–µ–ª–∏ —É–∫–∞–∑—ã–≤–∞—é—Ç –Ω–∞ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç—å –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏—è –∏ –æ—Ç–¥—ã—Ö–∞.")
        else:
            state.append("–¢—Ä–µ–±—É–µ—Ç—Å—è –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ ‚õÖ")
            state.append("–í—ã –∏—Å–ø—ã—Ç—ã–≤–∞–µ—Ç–µ –∑–Ω–∞—á–∏—Ç–µ–ª—å–Ω—É—é —É—Å—Ç–∞–ª–æ—Å—Ç—å –∏ –Ω–µ–¥–æ—Å—Ç–∞—Ç–æ–∫ —ç–Ω–µ—Ä–≥–∏–∏.")
            state.append("")
            state.append("–î–µ—Ç–∞–ª–∏:")
            state.append("- –ü–æ–∫–∞–∑–∞—Ç–µ–ª–∏ –≥–æ–≤–æ—Ä—è—Ç –æ —Ç–æ–º, —á—Ç–æ –≤–∞—à–µ–º—É –æ—Ä–≥–∞–Ω–∏–∑–º—É –Ω—É–∂–µ–Ω –æ—Ç–¥—ã—Ö –∏ –ø–æ–¥–¥–µ—Ä–∂–∫–∞.")

        # –û–ø—Ä–µ–¥–µ–ª—è–µ–º –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç–Ω—ã–µ –æ–±–ª–∞—Å—Ç–∏ –¥–ª—è —É–ª—É—á—à–µ–Ω–∏—è
        priorities = []
        if wellbeing < 4.0:
            priorities.append("—Å–∞–º–æ—á—É–≤—Å—Ç–≤–∏–µ")
        if activity < 4.0:
            priorities.append("–∞–∫—Ç–∏–≤–Ω–æ—Å—Ç—å")
        if mood < 4.0:
            priorities.append("–Ω–∞—Å—Ç—Ä–æ–µ–Ω–∏–µ")

        # –§–æ—Ä–º–∏—Ä—É–µ–º –ø–µ—Ä—Å–æ–Ω–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏
        if priorities:
            state.append(f"\n–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç–Ω—ã–µ –æ–±–ª–∞—Å—Ç–∏ –¥–ª—è —É–ª—É—á—à–µ–Ω–∏—è: {', '.join(priorities)} üí°")

        # –î–æ–±–∞–≤–ª—è–µ–º –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã–µ —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏
        state.append("\n–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏: üìã")

        # –ü—Ä–æ–≤–µ—Ä—è–µ–º –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏ –Ω–∏–∑–∫–∏–µ –ø–æ–∫–∞–∑–∞—Ç–µ–ª–∏
        if wellbeing <= 2.0 and activity <= 2.0 and mood <= 2.0:
            state.append("\n‚ùó –í–∞–∂–Ω–æ:")
            state.append("–ï—Å–ª–∏ –≤—ã –Ω–∞—Ö–æ–¥–∏—Ç–µ—Å—å –≤ –∫—Ä–∏–∑–∏—Å–Ω–æ–π —Å–∏—Ç—É–∞—Ü–∏–∏ –∏–ª–∏ –≤–∞–º —Ç—è–∂–µ–ª–æ —Å–ø—Ä–∞–≤–∏—Ç—å—Å—è —Å–∞–º–æ—Å—Ç–æ—è—Ç–µ–ª—å–Ω–æ,")
            state.append("–ø–æ–∑–≤–æ–Ω–∏—Ç–µ –Ω–∞ –ï–¥–∏–Ω—ã–π —Ç–µ–ª–µ—Ñ–æ–Ω –¥–æ–≤–µ—Ä–∏—è: +7 (495) 400-99-99")
            state.append("–ö–≤–∞–ª–∏—Ñ–∏—Ü–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ —Å–ø–µ—Ü–∏–∞–ª–∏—Å—Ç—ã –≥–æ—Ç–æ–≤—ã –≤–∞—Å –≤—ã—Å–ª—É—à–∞—Ç—å –∏ –ø–æ–¥–¥–µ—Ä–∂–∞—Ç—å 24/7")
            state.append("")

        # –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ –Ω–∞ –æ—Å–Ω–æ–≤–µ –∫–æ–º–±–∏–Ω–∞—Ü–∏–π –ø–æ–∫–∞–∑–∞—Ç–µ–ª–µ–π
        if wellbeing <= 2.0 and activity <= 2.0 and mood <= 2.0:
            state.append("- –û—Ç–¥–æ—Ö–Ω–∏, –¥—Ä—É–∂–∏—â–µ! 20 –º–∏–Ω—É—Ç –≤ —Ç–∏—à–∏–Ω–µ —Å –∑–∞–∫—Ä—ã—Ç—ã–º–∏ –≥–ª–∞–∑–∞–º–∏ üò¥")
            state.append("  ‚Üí –°–Ω–∏–∑–∏—Ç —É—Ä–æ–≤–µ–Ω—å —Å—Ç—Ä–µ—Å—Å–∞ –∏ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–∏—Ç —ç–Ω–µ—Ä–≥–∏—é")
            state.append("- –ü–æ–ø—Ä–æ–±—É–π —Ç–µ—Ö–Ω–∏–∫—É 4-7-8: –≤–¥–æ—Ö –Ω–∞ 4, –∑–∞–¥–µ—Ä–∂–∫–∞ –Ω–∞ 7, –≤—ã–¥–æ—Ö –Ω–∞ 8 üí®")
            state.append("  ‚Üí –ê–∫—Ç–∏–≤–∏—Ä—É–µ—Ç –ø–∞—Ä–∞—Å–∏–º–ø–∞—Ç–∏—á–µ—Å–∫—É—é –Ω–µ—Ä–≤–Ω—É—é —Å–∏—Å—Ç–µ–º—É –¥–ª—è —Ä–∞—Å—Å–ª–∞–±–ª–µ–Ω–∏—è")
            state.append("- –ü—Ä–∏–º–∏ —Ç—ë–ø–ª—ã–π –¥—É—à –∏–ª–∏ –≤–∞–Ω–Ω—É üõÄ")
            state.append("  ‚Üí –†–∞—Å—Å–ª–∞–±–∏—Ç –º—ã—à—Ü—ã –∏ —É–ª—É—á—à–∏—Ç –∫—Ä–æ–≤–æ–æ–±—Ä–∞—â–µ–Ω–∏–µ")
            state.append("- –û—Ç–ª–æ–∂–∏ –≤—Å–µ –¥–µ–ª–∞ –Ω–∞ 1-2 —á–∞—Å–∞, —Ç—ã –∑–∞—Å–ª—É–∂–∏–ª –æ—Ç–¥—ã—Ö üò≠")
            state.append("  ‚Üí –î–∞—Å—Ç –æ—Ä–≥–∞–Ω–∏–∑–º—É –≤—Ä–µ–º—è –Ω–∞ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ")
            state.append("- –ó–∞–ø–∏—à–∏ 3 –≤–µ—â–∏, –∑–∞ –∫–æ—Ç–æ—Ä—ã–µ —Ç—ã –±–ª–∞–≥–æ–¥–∞—Ä–µ–Ω —Å–µ–≥–æ–¥–Ω—è üìù")
            state.append("  ‚Üí –°–Ω–∏–∑–∏—Ç —É—Ä–æ–≤–µ–Ω—å –∫–æ—Ä—Ç–∏–∑–æ–ª–∞ –∏ –ø–æ–≤—ã—Å–∏—Ç —É—Ä–æ–≤–µ–Ω—å —Å–µ—Ä–æ—Ç–æ–Ω–∏–Ω–∞")
        elif wellbeing <= 3.0 and activity >= 5.0:
            state.append("- –ù–µ –ø–µ—Ä–µ–≥—Ä—É–∂–∞–π —Å–µ–±—è! –î–æ–±–∞–≤—å 15-–º–∏–Ω—É—Ç–Ω—ã–µ –ø–µ—Ä–µ—Ä—ã–≤—ã –º–µ–∂–¥—É –¥–µ–ª–∞–º–∏ üò¥")
            state.append("  ‚Üí –ü—Ä–µ–¥–æ—Ç–≤—Ä–∞—Ç–∏—Ç —ç–º–æ—Ü–∏–æ–Ω–∞–ª—å–Ω–æ–µ –≤—ã–≥–æ—Ä–∞–Ω–∏–µ")
            state.append("- –°–¥–µ–ª–∞–π –ª—ë–≥–∫—É—é —Ä–∞—Å—Ç—è–∂–∫—É 5 –º–∏–Ω—É—Ç üíÉ")
            state.append("  ‚Üí –£–ª—É—á—à–∏—Ç –∫—Ä–æ–≤–æ–æ–±—Ä–∞—â–µ–Ω–∏–µ –∏ —Å–Ω–∏–º–µ—Ç –º—ã—à–µ—á–Ω–æ–µ –Ω–∞–ø—Ä—è–∂–µ–Ω–∏–µ")
            state.append("- –ü—Ä–æ–≤–µ—Ä—å —Ä–µ–∂–∏–º —Å–Ω–∞: —Å–ø–∏ –Ω–µ –º–µ–Ω–µ–µ 7 —á–∞—Å–æ–≤ üò¥")
            state.append("  ‚Üí –û–±–µ—Å–ø–µ—á–∏—Ç –ø–æ–ª–Ω–æ—Ü–µ–Ω–Ω–æ–µ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ –æ—Ä–≥–∞–Ω–∏–∑–º–∞")
            state.append("- –ü–æ–ø—Ä–æ–±—É–π —Ç–µ—Ö–Ω–∏–∫—É –ø—Ä–æ–≥—Ä–µ—Å—Å–∏–≤–Ω–æ–π –º—ã—à–µ—á–Ω–æ–π —Ä–µ–ª–∞–∫—Å–∞—Ü–∏–∏ üí™")
            state.append("  ‚Üí –°–Ω–∏–º–µ—Ç —Ñ–∏–∑–∏—á–µ—Å–∫–æ–µ –∏ –ø—Å–∏—Ö–∏—á–µ—Å–∫–æ–µ –Ω–∞–ø—Ä—è–∂–µ–Ω–∏–µ")
        elif mood <= 3.0 and wellbeing >= 5.0:
            state.append("- –í–∫–ª—é—á–∏ –ª—é–±–∏–º—É—é –º—É–∑—ã–∫—É –Ω–∞ 10 –º–∏–Ω—É—Ç üé∂")
            state.append("  ‚Üí –°—Ç–∏–º—É–ª–∏—Ä—É–µ—Ç –≤—ã—Ä–∞–±–æ—Ç–∫—É –¥–æ—Ñ–∞–º–∏–Ω–∞ –∏ —ç–Ω–¥–æ—Ä—Ñ–∏–Ω–æ–≤")
            state.append("- –ü–æ–∑–≤–æ–Ω–∏ –±–ª–∏–∑–∫–æ–º—É —á–µ–ª–æ–≤–µ–∫—É üìû")
            state.append("  ‚Üí –ê–∫—Ç–∏–≤–∏—Ä—É–µ—Ç —Å–∏—Å—Ç–µ–º—É —Å–æ—Ü–∏–∞–ª—å–Ω–æ–π –ø–æ–¥–¥–µ—Ä–∂–∫–∏")
            state.append("- –ü–æ—Å–º–æ—Ç—Ä–∏ —á—Ç–æ-–Ω–∏–±—É–¥—å —Å–º–µ—à–Ω–æ–µ üòÇ")
            state.append("  ‚Üí –í—ã–∑–æ–≤–µ—Ç –µ—Å—Ç–µ—Å—Ç–≤–µ–Ω–Ω—ã–π –≤—ã–±—Ä–æ—Å —ç–Ω–¥–æ—Ä—Ñ–∏–Ω–æ–≤")
            state.append("- –ó–∞–ø–∏—à–∏ 3 –ø—Ä–∏—è—Ç–Ω—ã—Ö –º–æ–º–µ–Ω—Ç–∞ –∑–∞ —Å–µ–≥–æ–¥–Ω—è üìù")
            state.append("  ‚Üí –ü–µ—Ä–µ–Ω–∞—Å—Ç—Ä–æ–∏—Ç —Ñ–æ–∫—É—Å –≤–Ω–∏–º–∞–Ω–∏—è –Ω–∞ –ø–æ–∑–∏—Ç–∏–≤")
        elif activity <= 3.0 and mood >= 5.0:
            state.append("- –ü—Ä–æ–≥—É–ª—è–π—Å—è 15 –º–∏–Ω—É—Ç –Ω–∞ —Å–≤–µ–∂–µ–º –≤–æ–∑–¥—É—Ö–µ üåç")
            state.append("  ‚Üí –£–≤–µ–ª–∏—á–∏—Ç —É—Ä–æ–≤–µ–Ω—å –∫–∏—Å–ª–æ—Ä–æ–¥–∞ –≤ –∫—Ä–æ–≤–∏")
            state.append("- –ü–æ—Ç–∞–Ω—Ü—É–π –ø–æ–¥ –ª—é–±–∏–º—É—é –ø–µ—Å–Ω—é üíÉ")
            state.append("  ‚Üí –ê–∫—Ç–∏–≤–∏—Ä—É–µ—Ç –¥–≤–∏–≥–∞—Ç–µ–ª—å–Ω—ã–µ —Ü–µ–Ω—Ç—Ä—ã –º–æ–∑–≥–∞")
            state.append("- –ü–æ–ø—Ä–æ–±—É–π –π–æ–≥—É –∏–ª–∏ –ª—ë–≥–∫—É—é –∑–∞—Ä—è–¥–∫—É üßò")
            state.append("  ‚Üí –£–ª—É—á—à–∏—Ç –∫—Ä–æ–≤–æ–æ–±—Ä–∞—â–µ–Ω–∏–µ –∏ –ø–æ–≤—ã—Å–∏—Ç —ç–Ω–µ—Ä–≥–∏—é")
            state.append("- –°–¥–µ–ª–∞–π 5-–º–∏–Ω—É—Ç–Ω—É—é —Ç–µ—Ö–Ω–∏–∫—É 4-7-8 üí®")
            state.append("  ‚Üí –û–ø—Ç–∏–º–∏–∑–∏—Ä—É–µ—Ç —Ä–∞–±–æ—Ç—É –¥—ã—Ö–∞—Ç–µ–ª—å–Ω–æ–π —Å–∏—Å—Ç–µ–º—ã")
        elif overall_score >= 5.5:
            state.append("- –ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞–π —Ä–∏—Ç–º: 45 –º–∏–Ω—É—Ç –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏, 10 –º–∏–Ω—É—Ç –æ—Ç–¥—ã—Ö–∞ ‚è∞")
            state.append("  ‚Üí –û–ø—Ç–∏–º–∏–∑–∏—Ä—É–µ—Ç –ø—Ä–æ–¥—É–∫—Ç–∏–≤–Ω–æ—Å—Ç—å –∏ –ø—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–∞–µ—Ç —É—Å—Ç–∞–ª–æ—Å—Ç—å")
            state.append("- –ü–æ–ø—Ä–æ–±—É–π –Ω–æ–≤–æ–µ —Ö–æ–±–±–∏ –∏–ª–∏ –Ω–∞–≤—ã–∫ üéØ")
            state.append("  ‚Üí –°—Ç–∏–º—É–ª–∏—Ä—É–µ—Ç –Ω–µ–π—Ä–æ–ø–ª–∞—Å—Ç–∏—á–Ω–æ—Å—Ç—å –º–æ–∑–≥–∞")
            state.append("- –ü–æ–¥–µ–ª–∏—Å—å —ç–Ω–µ—Ä–≥–∏–µ–π —Å –¥—Ä—É–≥–∏–º–∏ üëã")
            state.append("  ‚Üí –£—Å–∏–ª–∏—Ç —á—É–≤—Å—Ç–≤–æ —Å–æ—Ü–∏–∞–ª—å–Ω–æ–π —Å–≤—è–∑–∞–Ω–Ω–æ—Å—Ç–∏")
            state.append("- –ó–∞–ø–ª–∞–Ω–∏—Ä—É–π –∞–∫—Ç–∏–≤–Ω—ã–π –æ—Ç–¥—ã—Ö –Ω–∞ –≤—ã—Ö–æ–¥–Ω—ã–µ üèû")
            state.append("  ‚Üí –°–æ–∑–¥–∞—Å—Ç –ø–æ–∑–∏—Ç–∏–≤–Ω–æ–µ –æ–∂–∏–¥–∞–Ω–∏–µ –∏ –º–æ—Ç–∏–≤–∞—Ü–∏—é")
            state.append("- –ó–∞–ø–∏—à–∏ 3 —Ü–µ–ª–∏ –Ω–∞ –∑–∞–≤—Ç—Ä–∞ üìù")
            state.append("  ‚Üí –ê–∫—Ç–∏–≤–∏—Ä—É–µ—Ç —Å–∏—Å—Ç–µ–º—É –≤–æ–∑–Ω–∞–≥—Ä–∞–∂–¥–µ–Ω–∏—è –º–æ–∑–≥–∞")
        elif overall_score >= 4.5:
            state.append("- –°–¥–µ–ª–∞–π 10-–º–∏–Ω—É—Ç–Ω—É—é –¥—ã—Ö–∞—Ç–µ–ª—å–Ω—É—é –≥–∏–º–Ω–∞—Å—Ç–∏–∫—É üí®")
            state.append("  ‚Üí –ù–æ—Ä–º–∞–ª–∏–∑—É–µ—Ç —Ä–∞–±–æ—Ç—É –≤–µ–≥–µ—Ç–∞—Ç–∏–≤–Ω–æ–π –Ω–µ—Ä–≤–Ω–æ–π —Å–∏—Å—Ç–µ–º—ã")
            state.append("- –í—ã–ø–µ–π —Ç—ë–ø–ª—ã–π —á–∞–π –∏ –æ—Ç–¥–æ—Ö–Ω–∏ 15 –º–∏–Ω—É—Ç ‚òï")
            state.append("  ‚Üí –°–Ω–∏–∑–∏—Ç —É—Ä–æ–≤–µ–Ω—å —Å—Ç—Ä–µ—Å—Å–∞ –∏ —É–ª—É—á—à–∏—Ç –∫–æ–Ω—Ü–µ–Ω—Ç—Ä–∞—Ü–∏—é")
            state.append("- –ó–∞–ø–∏—à–∏ 3 —Ü–µ–ª–∏ –Ω–∞ —Å–µ–≥–æ–¥–Ω—è üìù")
            state.append("  ‚Üí –°–æ–∑–¥–∞—Å—Ç —Å—Ç—Ä—É–∫—Ç—É—Ä—É –∏ –Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –¥–µ–π—Å—Ç–≤–∏–π")
            state.append("- –°–¥–µ–ª–∞–π –ª—ë–≥–∫—É—é —Ä–∞–∑–º–∏–Ω–∫—É üí™")
            state.append("  ‚Üí –£–ª—É—á—à–∏—Ç –∫—Ä–æ–≤–æ–æ–±—Ä–∞—â–µ–Ω–∏–µ –∏ –ø–æ–≤—ã—Å–∏—Ç –±–æ–¥—Ä–æ—Å—Ç—å")
            state.append("- –ü–æ–ø—Ä–æ–±—É–π —Ç–µ—Ö–Ω–∏–∫—É 4-7-8 –¥–ª—è —Ä–∞—Å—Å–ª–∞–±–ª–µ–Ω–∏—è üí®")
            state.append("  ‚Üí –°–Ω–∏–∑–∏—Ç —É—Ä–æ–≤–µ–Ω—å —Ç—Ä–µ–≤–æ–∂–Ω–æ—Å—Ç–∏")
        elif overall_score >= 3.5:
            state.append("- –ü–æ–∑–≤–æ–ª—å —Å–µ–±–µ 5 –º–∏–Ω—É—Ç –º–µ–¥–∏—Ç–∞—Ü–∏–∏ üò¥")
            state.append("  ‚Üí –°–Ω–∏–∑–∏—Ç —É—Ä–æ–≤–µ–Ω—å –∫–æ—Ä—Ç–∏–∑–æ–ª–∞ –∏ —É–ª—É—á—à–∏—Ç –∫–æ–Ω—Ü–µ–Ω—Ç—Ä–∞—Ü–∏—é")
            state.append("- –í—ã–ø–µ–π —Å—Ç–∞–∫–∞–Ω –≤–æ–¥—ã üíß")
            state.append("  ‚Üí –£–ª—É—á—à–∏—Ç –∫–æ–≥–Ω–∏—Ç–∏–≤–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏ –∏ —É—Ä–æ–≤–µ–Ω—å —ç–Ω–µ—Ä–≥–∏–∏")
            state.append("- –°–¥–µ–ª–∞–π 3-5 –ø—Ä–æ—Å—Ç—ã—Ö —É–ø—Ä–∞–∂–Ω–µ–Ω–∏–π üí™")
            state.append("  ‚Üí –ê–∫—Ç–∏–≤–∏—Ä—É–µ—Ç –≤—ã—Ä–∞–±–æ—Ç–∫—É —ç–Ω–¥–æ—Ä—Ñ–∏–Ω–æ–≤")
            state.append("- –ü–æ–∑–≤–æ–Ω–∏ –¥—Ä—É–≥—É üìû")
            state.append("  ‚Üí –°–Ω–∏–∑–∏—Ç —É—Ä–æ–≤–µ–Ω—å —Å—Ç—Ä–µ—Å—Å–∞ —á–µ—Ä–µ–∑ —Å–æ—Ü–∏–∞–ª—å–Ω—É—é –ø–æ–¥–¥–µ—Ä–∂–∫—É")
            state.append("- –ó–∞–ø–∏—à–∏ 3 –≤–µ—â–∏, –∑–∞ –∫–æ—Ç–æ—Ä—ã–µ —Ç—ã –±–ª–∞–≥–æ–¥–∞—Ä–µ–Ω üìù")
            state.append("  ‚Üí –°–Ω–∏–∑–∏—Ç —É—Ä–æ–≤–µ–Ω—å —Ç—Ä–µ–≤–æ–∂–Ω–æ—Å—Ç–∏ –∏ —É–ª—É—á—à–∏—Ç –Ω–∞—Å—Ç—Ä–æ–µ–Ω–∏–µ")
        else:
            state.append("- –°–¥–µ–ª–∞–π –ø–∞—É–∑—É: 20 –º–∏–Ω—É—Ç –æ—Ç–¥—ã—Ö–∞ üò¥")
            state.append("  ‚Üí –î–∞—Å—Ç –æ—Ä–≥–∞–Ω–∏–∑–º—É –≤—Ä–µ–º—è –Ω–∞ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ")
            state.append("- –í—ã–ø–µ–π —Ç—ë–ø–ª—ã–π —á–∞–π ‚òï")
            state.append("  ‚Üí –°–Ω–∏–∑–∏—Ç —É—Ä–æ–≤–µ–Ω—å —Å—Ç—Ä–µ—Å—Å–∞ –∏ —É–ª—É—á—à–∏—Ç –∫–æ–Ω—Ü–µ–Ω—Ç—Ä–∞—Ü–∏—é")
            state.append("- –ü–æ–ø—Ä–æ–±—É–π —Ç–µ—Ö–Ω–∏–∫—É 4-7-8: –≤–¥–æ—Ö –Ω–∞ 4, –∑–∞–¥–µ—Ä–∂–∫–∞ –Ω–∞ 7, –≤—ã–¥–æ—Ö –Ω–∞ 8 üí®")
            state.append("  ‚Üí –ê–∫—Ç–∏–≤–∏—Ä—É–µ—Ç –ø–∞—Ä–∞—Å–∏–º–ø–∞—Ç–∏—á–µ—Å–∫—É—é –Ω–µ—Ä–≤–Ω—É—é —Å–∏—Å—Ç–µ–º—É")
            state.append("- –ü–æ—Å–ª—É—à–∞–π —Å–ø–æ–∫–æ–π–Ω—É—é –º—É–∑—ã–∫—É üé∂")
            state.append("  ‚Üí –°–Ω–∏–∑–∏—Ç —É—Ä–æ–≤–µ–Ω—å –∫–æ—Ä—Ç–∏–∑–æ–ª–∞ –∏ —É–ª—É—á—à–∏—Ç –Ω–∞—Å—Ç—Ä–æ–µ–Ω–∏–µ")
            state.append("- –ó–∞–ø–∏—à–∏ 3 –ø—Ä–∏—è—Ç–Ω—ã—Ö –º–æ–º–µ–Ω—Ç–∞ –∑–∞ —Å–µ–≥–æ–¥–Ω—è üìù")
            state.append("  ‚Üí –ü–µ—Ä–µ–Ω–∞—Å—Ç—Ä–æ–∏—Ç —Ñ–æ–∫—É—Å –≤–Ω–∏–º–∞–Ω–∏—è –Ω–∞ –ø–æ–∑–∏—Ç–∏–≤")

        # –î–æ–±–∞–≤–ª—è–µ–º —Å–ø–µ—Ü–∏—Ñ–∏—á–µ—Å–∫–∏–µ —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ –ø–æ –∫–∞–∂–¥–æ–º—É –ø–æ–∫–∞–∑–∞—Ç–µ–ª—é
        if wellbeing <= 3.0:
            state.append("\n–î–ª—è —É–ª—É—á—à–µ–Ω–∏—è —Å–∞–º–æ—á—É–≤—Å—Ç–≤–∏—è: üí™")
            state.append("- –ü—Ä–æ–≤–µ—Ä—å —Ä–µ–∂–∏–º —Å–Ω–∞ –∏ –ø–∏—Ç–∞–Ω–∏—è üò¥")
            state.append("  ‚Üí –û–±–µ—Å–ø–µ—á–∏—Ç –±–∞–∑–æ–≤—ã–µ –ø–æ—Ç—Ä–µ–±–Ω–æ—Å—Ç–∏ –æ—Ä–≥–∞–Ω–∏–∑–º–∞")
            state.append("- –°–¥–µ–ª–∞–π –ª—ë–≥–∫—É—é —Ä–∞—Å—Ç—è–∂–∫—É üíÉ")
            state.append("  ‚Üí –£–ª—É—á—à–∏—Ç –∫—Ä–æ–≤–æ–æ–±—Ä–∞—â–µ–Ω–∏–µ –∏ –≥–∏–±–∫–æ—Å—Ç—å")
            state.append("- –ü—Ä–æ–≤–µ—Ç—Ä–∏ –ø–æ–º–µ—â–µ–Ω–∏–µ üå¨")
            state.append("  ‚Üí –£–≤–µ–ª–∏—á–∏—Ç —É—Ä–æ–≤–µ–Ω—å –∫–∏—Å–ª–æ—Ä–æ–¥–∞ –≤ –∫—Ä–æ–≤–∏")
            state.append("- –ü–æ–ø—Ä–æ–±—É–π —Ç–µ—Ö–Ω–∏–∫—É –ø—Ä–æ–≥—Ä–µ—Å—Å–∏–≤–Ω–æ–π –º—ã—à–µ—á–Ω–æ–π —Ä–µ–ª–∞–∫—Å–∞—Ü–∏–∏ üí™")
            state.append("  ‚Üí –°–Ω–∏–º–µ—Ç —Ñ–∏–∑–∏—á–µ—Å–∫–æ–µ –∏ –ø—Å–∏—Ö–∏—á–µ—Å–∫–æ–µ –Ω–∞–ø—Ä—è–∂–µ–Ω–∏–µ")

        if activity <= 3.0:
            state.append("\n–î–ª—è –ø–æ–≤—ã—à–µ–Ω–∏—è –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏: üèÉ")
            state.append("- –°–¥–µ–ª–∞–π 10 –ø—Ä–∏—Å–µ–¥–∞–Ω–∏–π üí™")
            state.append("  ‚Üí –ê–∫—Ç–∏–≤–∏—Ä—É–µ—Ç –∫—Ä—É–ø–Ω—ã–µ –º—ã—à–µ—á–Ω—ã–µ –≥—Ä—É–ø–ø—ã")
            state.append("- –ü—Ä–æ–π–¥–∏—Å—å –ø–æ –ª–µ—Å—Ç–Ω–∏—Ü–µ üèÉ")
            state.append("  ‚Üí –£–ª—É—á—à–∏—Ç –∫—Ä–æ–≤–æ–æ–±—Ä–∞—â–µ–Ω–∏–µ –∏ –ø–æ–≤—ã—Å–∏—Ç —ç–Ω–µ—Ä–≥–∏—é")
            state.append("- –°–¥–µ–ª–∞–π 5-–º–∏–Ω—É—Ç–Ω—É—é –∑–∞—Ä—è–¥–∫—É üí™")
            state.append("  ‚Üí –°—Ç–∏–º—É–ª–∏—Ä—É–µ—Ç –≤—ã—Ä–∞–±–æ—Ç–∫—É —ç–Ω–¥–æ—Ä—Ñ–∏–Ω–æ–≤")
            state.append("- –ü–æ–ø—Ä–æ–±—É–π —Ç–µ—Ö–Ω–∏–∫—É 4-7-8 –¥–ª—è –±–æ–¥—Ä–æ—Å—Ç–∏ üí®")
            state.append("  ‚Üí –£–≤–µ–ª–∏—á–∏—Ç —É—Ä–æ–≤–µ–Ω—å –∫–∏—Å–ª–æ—Ä–æ–¥–∞ –≤ –∫—Ä–æ–≤–∏")

        if mood <= 3.0:
            state.append("\n–î–ª—è —É–ª—É—á—à–µ–Ω–∏—è –Ω–∞—Å—Ç—Ä–æ–µ–Ω–∏—è: üòä")
            state.append("- –í—Å–ø–æ–º–Ω–∏ –ø—Ä–∏—è—Ç–Ω—ã–π –º–æ–º–µ–Ω—Ç üòç")
            state.append("  ‚Üí –ê–∫—Ç–∏–≤–∏—Ä—É–µ—Ç –ø–æ–∑–∏—Ç–∏–≤–Ω—ã–µ –Ω–µ–π—Ä–æ–Ω–Ω—ã–µ —Å–≤—è–∑–∏")
            state.append("- –ü–æ—Å–º–æ—Ç—Ä–∏ —Å–º–µ—à–Ω–æ–µ –≤–∏–¥–µ–æ üòÇ")
            state.append("  ‚Üí –í—ã–∑–æ–≤–µ—Ç –µ—Å—Ç–µ—Å—Ç–≤–µ–Ω–Ω—ã–π –≤—ã–±—Ä–æ—Å —ç–Ω–¥–æ—Ä—Ñ–∏–Ω–æ–≤")
            state.append("- –ü–æ–∑–≤–æ–Ω–∏ –¥—Ä—É–≥—É üìû")
            state.append("  ‚Üí –ê–∫—Ç–∏–≤–∏—Ä—É–µ—Ç —Å–∏—Å—Ç–µ–º—É —Å–æ—Ü–∏–∞–ª—å–Ω–æ–π –ø–æ–¥–¥–µ—Ä–∂–∫–∏")
            state.append("- –ó–∞–ø–∏—à–∏ 3 –≤–µ—â–∏, –∑–∞ –∫–æ—Ç–æ—Ä—ã–µ —Ç—ã –±–ª–∞–≥–æ–¥–∞—Ä–µ–Ω üìù")
            state.append("  ‚Üí –°–Ω–∏–∑–∏—Ç —É—Ä–æ–≤–µ–Ω—å —Ç—Ä–µ–≤–æ–∂–Ω–æ—Å—Ç–∏ –∏ —É–ª—É—á—à–∏—Ç –Ω–∞—Å—Ç—Ä–æ–µ–Ω–∏–µ")

        return "\n".join(state)


    def save_result(self, user_id: str, wellbeing: float, activity: float, mood: float) -> bool:
        """–°–æ—Ö—Ä–∞–Ω—è–µ—Ç —Ä–µ–∑—É–ª—å—Ç–∞—Ç –≤ Firebase."""
        if not user_id:
            raise ValueError("–¢—Ä–µ–±—É–µ—Ç—Å—è ID –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è.")

        timestamp = int(datetime.now().timestamp() * 1000)
        result_data = {
            'wellbeingScore': wellbeing,
            'activityScore': activity,
            'moodScore': mood,
            'timestamp': timestamp
        }
        ref = db.reference(f'Users/{user_id}/TestResults')
        new_ref = ref.push(result_data)
        return new_ref.key is not None  # –£—Å–ø–µ—Ö –µ—Å–ª–∏ –∫–ª—é—á —Å–æ–∑–¥–∞–Ω